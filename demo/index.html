<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Big Data Science</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  </head>
  <body>
    <nav class="navbar navbar-dark" style="background-color: #08872a;">
      <a class="navbar-brand" href="#">
        Project
      </a>
    </nav>

    <div class="container-fluid">
      <div class="row">
        <div class="col d-flex justify-content-center text-center">
          <h1><span class="badge badge-success">#Tweets / day</span></h1>
        </div>
        <div class="col d-flex justify-content-center text-center">
          <h1><span class="badge badge-success">Occurences of keywords</span></h1>
        </div>
      </div>
      <div class="row">
        <div class="col d-flex justify-content-center text-center">
          <div id="graph" class="svg-container"></div>
        </div>
        <div class="col d-flex justify-content-center text-center">
          <div id="graph_keywords" class="svg-container"></div>
        </div>
      </div>
      <div class="row">
        <div class="col d-flex justify-content-center text-center">
          <h1><span class="badge badge-success">#Tweets / day</span></h1>
        </div>
        <div class="col d-flex justify-content-center text-center">
          <h1><span class="badge badge-success">#Covid cases / day</span></h1>
        </div>
      </div>
      <div class="row">
        <div class="col d-flex justify-content-center text-center">
          <div id="graph-tweets-line" class="svg-container">
          </div>
        </div>
        <div class="col d-flex justify-content-center text-center">
          <div id="prog" class="progress">
            <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">Loading data</div>
          </div>
          <div id="graph-covid-line" class="svg-container"></div>
        </div>
      </div>
    </div>
  </body>
  <script type="text/javascript" src="d3/d3.min.js"></script>
  <script>
    d3.csv('tweets_per_day.csv').then(function(data){
      var svg = d3.select('#graph').append('svg').attr("preserveAspectRatio", "xMinYMin meet").attr("viewBox", "0 0 200 200").classed("svg-content", true);
      var svg2 = d3.select('#graph-tweets-line').append('svg').attr("preserveAspectRatio", "xMinYMin meet").attr("viewBox", "0 0 200 200").classed("svg-content", true);
      var bars = svg.selectAll('rect').data(data).enter();
      var numDays = data.length;
      var max = d3.max(data, function(d){ return +d['counts'] })
      var yScale = d3.scaleLinear().domain([max, 0]).range([0, 130]);
      var xScale = d3.scaleTime().domain(d3.extent(data, function(d) {
        return new Date(d['date'])
      })).range([20, 190]);
      
      var xAxis = d3.axisBottom().scale(xScale).ticks(14);
      var yAxis = d3.axisLeft().scale(yScale).ticks(20);
      svg.append('g').attr('class','axis').attr("transform", "translate(0,150)").call(xAxis).selectAll('text').attr('y',0).attr('x', 15).attr("transform", "rotate(90)")
      svg.append('g').attr('class','axis').style("font", "5px times").attr("transform", "translate(18,20)").call(yAxis)
      
      svg2.append('g').attr('class','axis').attr("transform", "translate(0,130)").call(xAxis).selectAll('text').attr('y',0).attr('x', 15).attr("transform", "rotate(90)")
      svg2.append('g').attr('class','axis').style("font", "5px times").attr("transform", "translate(18,0)").call(yAxis)

      svg2.append("path")
      .datum(data)
      .attr("fill", "none")
      .attr("stroke", "rgb(94, 204, 123)")
      .attr("stroke-width", 1)
      .attr("d", d3.line()
        .x(function(d, i) { return xScale(new Date(d['date'])) })
        .y(function(d) { return yScale(d['counts'])
       }).curve(d3.curveMonotoneX)
      )

      var rects = bars.append('rect')
        .attr('x', (data, i) => {
        return xScale(new Date(data['date']));
      }).attr('y', (data, i) => {
        return yScale(data['counts'])+20
      }).attr('height', (data, i) => {
        return 130 - yScale(data['counts'])
      }).attr('width', (180 / numDays)-1)
      .style('fill','rgb(94, 204, 123)');
            
      rects.on("mouseover", function(d){
        var currentBar = d3.select(this);
        currentBar.style('fill','rgb(53, 150, 78)')
        var x = currentBar.attr('x')
        var y = currentBar.attr('y')
        svg.append('text').attr('x', x).attr('y', y-10).text(d['counts']).attr('id', 'countLabel').style("font", '8px sans-serif')
    	});
      rects.on("mouseout", function(d){
        var currentBar = d3.select(this);
        currentBar.style('fill','rgb(94, 204, 123)');
        svg.selectAll('#countLabel').remove()
      });
      
    })

    keywords = []
    d3.csv('keyword_count.csv').then(function(data){
        data.sort(function(x, y) {
        return y['count'] - x['count']
      })
      data.forEach(d => {
        keywords.push(d['keyword']);
      });

      var svg = d3.select('#graph_keywords').append('svg').attr("preserveAspectRatio", "xMinYMin meet").attr("viewBox", "0 0 200 200").classed("svg-content", true);
      var bars = svg.selectAll('rect').data(data).enter();
      var max = d3.max(data, function(d){ return +d['count'] })
      var yScale = d3.scaleLinear().domain([max, 0]).range([0, 130]);
      var xScale = d3.scaleBand().domain(keywords).range([20, 190]);
      var yAxis = d3.axisLeft().scale(yScale).ticks(10);
      var xAxis = d3.axisBottom().scale(xScale)
      svg.append('g').attr('class','axis').style("font", "4px times").attr("transform", "translate(-1,150)").call(xAxis)

      svg.append('g').attr('class','axis').style("font", "4px times").attr("transform", "translate(19,20)").call(yAxis)
    
      var rects = bars.append('rect')
        .attr('x', (data, i) => {
        return xScale(data['keyword']); 
      }).attr('y', (data, i) => {
        return yScale(data['count'])+20
      }).attr('height', (data, i) => {
        return 130 - yScale(data['count'])
      }).attr('width', (180 / data.length)-5)
      .style('fill','rgb(94, 204, 123)')
      
      data.forEach(data => {
        svg.append('text')
        .text(data['count'])
        .attr('x', xScale(data['keyword']))
        .attr('y', yScale(data['count']) + 18)
        .style("font", '8px sans-serif')
      })
    })

    covid = {}
    d3.csv('COVID19BE_CASES_AGESEX.csv', function(d) {
      if (d['DATE'] in covid)
        covid[d['DATE']] = { date: d['DATE'], count: covid[d['DATE']]['count'] + parseInt(d['CASES'], 0) }
      else
        covid[d['DATE']] = { date: d['DATE'], count: parseInt(d['CASES'], 0) }
    }).then(data => {
      delete covid['NA']
      covid_data = Object.values(covid)
      d3.select('#prog').style('display', 'none')

      var svg = d3.select('#graph-covid-line').append('svg').attr("preserveAspectRatio", "xMinYMin meet").attr("viewBox", "0 0 200 200").classed("svg-content", true);
      var numDays = covid_data.length;
      var max = d3.max(covid_data, function(d){ return +d['count'] })
      var yScale = d3.scaleLinear().domain([max, 0]).range([0, 130]);
      var xScale = d3.scaleTime().domain(d3.extent(covid_data, function(d) {
        return new Date(d['date'])
      })).range([20, 190]);
      
      var xAxis = d3.axisBottom().scale(xScale).ticks(14);
      var yAxis = d3.axisLeft().scale(yScale).ticks(10);
      
      svg.append('g').attr('class','axis').attr("transform", "translate(0,130)").call(xAxis).selectAll('text').attr('y',0).attr('x', 15).attr("transform", "rotate(90)")
      svg.append('g').attr('class','axis').style("font", "4px times").attr("transform", "translate(19,0)").call(yAxis)
      console.log(covid_data)
      svg.append("path")
      .datum(covid_data)
      .attr("fill", "none")
      .attr("stroke", "rgb(94, 204, 123)")
      .attr("stroke-width", 1)
      .attr("d", d3.line()
        .x(function(d, i) { return xScale(new Date(d['date'])) })
        .y(function(d) { return yScale(d['count'])
       }).curve(d3.curveMonotoneX)
      )
      
    })






  </script>
  <style>
    .svg-container {
    display: inline-block;
    position: relative;
    width: 100%;
    padding-bottom: 100%;
    vertical-align: top;
    overflow: hidden;
  }
  .svg-content {
    display: inline-block;
    position: absolute;
    top: 0;
    left: 0;
  }
  .axis {
  font: 5px sans-serif;
}

.axis path,
.axis line {
  fill: none;
  stroke: #08872a;
  stroke-width: 0.8px;
}
  </style>
</html>